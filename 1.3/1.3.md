# Домашнее задание к занятию «Запуск приложений в K8S»

### Цель задания

В тестовой среде для работы с Kubernetes, установленной в предыдущем ДЗ, необходимо развернуть Deployment с приложением, состоящим из нескольких контейнеров, и масштабировать его.

------

### Чеклист готовности к домашнему заданию

1. Установленное k8s-решение (например, MicroK8S).
2. Установленный локальный kubectl.
3. Редактор YAML-файлов с подключённым git-репозиторием.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Описание](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/) Deployment и примеры манифестов.
2. [Описание](https://kubernetes.io/docs/concepts/workloads/pods/init-containers/) Init-контейнеров.
3. [Описание](https://github.com/wbitt/Network-MultiTool) Multitool.

------

### Задание 1. Создать Deployment и обеспечить доступ к репликам приложения из другого Pod

1. Создать Deployment приложения, состоящего из двух контейнеров — nginx и multitool. Решить возникшую ошибку.
2. После запуска увеличить количество реплик работающего приложения до 2.
3. Продемонстрировать количество подов до и после масштабирования.
4. Создать Service, который обеспечит доступ до реплик приложений из п.1.
5. Создать отдельный Pod с приложением multitool и убедиться с помощью `curl`, что из пода есть доступ до приложений из п.1.

------
### Ответ 1.
1. Проблема была в том, что оба контейнера пытаются развернуться на одних портах. Причем если смотреть логи пода, то он показывает только логи nginx.  Который стартует как раз-таки успешно. 

![Снимок экрана 2024-08-03 в 16 05 34](https://github.com/user-attachments/assets/b86084e5-c3c9-4e65-91ca-ec83a7c49bdb)

Но мы шарим что там два контейнера, лезем точечно во второй и там видим проблему:  

![Снимок экрана 2024-08-03 в 16 06 06](https://github.com/user-attachments/assets/719508d5-2394-4511-bfc0-aae1b60e1b74)


Решена разделением портов. [Deployment](https://github.com/alexandreevich/kuber-homeworks/blob/main/1.3/deployment_example.yml)
Успешно статуем, реплика изначально одна:

![Снимок экрана 2024-08-03 в 16 09 42](https://github.com/user-attachments/assets/79d4ddd2-481e-48ae-8b97-3c74331c0c11)


2-3.Увеличиваем до двух, обновляем, выводим: 

![Снимок экрана 2024-08-03 в 18 03 17](https://github.com/user-attachments/assets/f2ad724e-48d8-44b0-94f3-aa83980cb616)

4. Создаем [Service](https://github.com/alexandreevich/kuber-homeworks/blob/main/1.3/svc-nginx-multi.yml)

Курлуем: 

![Снимок экрана 2024-08-03 в 18 37 40](https://github.com/user-attachments/assets/4c0f5dd6-2c6a-4c5d-93a3-6a30d05bf481)



5. Разворачиваем [multitool](https://github.com/alexandreevich/kuber-homeworks/blob/main/1.3/multitool.yml)

Курлем с него двумя вариантами: 

![Снимок экрана 2024-08-03 в 18 40 25](https://github.com/user-attachments/assets/52e2fd8d-38fb-44e9-90f2-87138d49ebed)




------

### Задание 2. Создать Deployment и обеспечить старт основного контейнера при выполнении условий

1. Создать Deployment приложения nginx и обеспечить старт контейнера только после того, как будет запущен сервис этого приложения.
2. Убедиться, что nginx не стартует. В качестве Init-контейнера взять busybox.
3. Создать и запустить Service. Убедиться, что Init запустился.
4. Продемонстрировать состояние пода до и после запуска сервиса.

------
### Ответ 2.

1. [Deployment](https://github.com/alexandreevich/kuber-homeworks/blob/main/1.3/deployment2.yml)
2. Контейнер не поднялся, тк сервис не отвечает:

![Снимок экрана 2024-08-03 в 19 06 33](https://github.com/user-attachments/assets/68f8df70-dbbb-49e6-8560-bf0947c29bc7)

3. Создаем [Service](https://github.com/alexandreevich/kuber-homeworks/blob/main/1.3/svc-nginx2.yml)
4. Успешно старует nginx. 

![Снимок экрана 2024-08-03 в 19 09 16](https://github.com/user-attachments/assets/eb1cf150-f001-4ffa-abe0-a86fc8fda631)




------
### Правила приема работы

1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl` и скриншоты результатов.
3. Репозиторий должен содержать файлы манифестов и ссылки на них в файле README.md.

------
